import{R as S,u as N,r as h,s as f,j as e,a as g,b as y,f as T,C as F,m as M,c as P}from"./index-kzrfnj9a.js";import{P as i,C as B,g as G,S as w,p as O,a as E,c as I}from"./Settings-CSzFMnEA.js";const C=S.memo(({hasGameStarted:s,isGameOver:r,isWhiteTurn:l,isFlipped:n,timerDuration:a})=>{const d=N(),[c,u]=h.useState(a),[j,x]=h.useState(a),t=h.useRef(null);h.useEffect(()=>{s&&(u(a),x(a))},[s,r,a]),h.useEffect(()=>{r||(c===0?d(f(!0,"Black Won by Time")):j===0&&d(f(!0,"White Won by Time")))},[c,j,r,d]),h.useEffect(()=>{if(!s||r){t.current&&(clearInterval(t.current),t.current=null),u(a),x(a);return}if(!t.current)return t.current=setInterval(()=>{l?u(m=>m<=1?(clearInterval(t.current),t.current=null,0):m-1):x(m=>m<=1?(clearInterval(t.current),t.current=null,0):m-1)},1e3),()=>{clearInterval(t.current),t.current=null}},[s,r,a,d,l]);const p=l?"active-turn":"",o=l?"":"active-turn";return e.jsx("div",{className:"left-panel",children:e.jsx("div",{className:"clocks-container",children:n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`clock ${p}`,children:[e.jsx("span",{role:"img","aria-label":"whitesymbol",children:"⚪"})," ",c]}),e.jsxs("div",{className:`clock ${o}`,children:[e.jsx("span",{role:"img","aria-label":"blacksymbol",children:"⚫"})," ",j]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`clock ${o}`,children:[e.jsx("span",{role:"img","aria-label":"blacksymbol",children:"⚫"})," ",j]}),e.jsxs("div",{className:`clock ${p}`,children:[e.jsx("span",{role:"img","aria-label":"whitesymbol",children:"⚪"})," ",c]})]})})})});C.propTypes={hasGameStarted:i.bool.isRequired,isWhiteTurn:i.bool.isRequired,isGameOver:i.bool.isRequired,isFlipped:i.bool.isRequired,timerDuration:i.number.isRequired};const $=({moveHistory:s})=>{const r=h.useRef(null);return h.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[s]),e.jsxs("div",{className:"move-history",children:[e.jsx("h3",{children:"Move History"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"White"}),e.jsx("th",{children:"Black"})]})}),e.jsx("tbody",{ref:r,children:s&&s.map((l,n)=>n%2===0?e.jsxs("tr",{children:[e.jsxs("td",{children:[Math.floor(n/2)+1,"."]}),e.jsx("td",{children:l}),e.jsx("td",{children:s[n+1]||""})]},n/2):null)})]})]})},k=({className:s,handleMove:r,fen:l,lastMove:n,isFlipped:a})=>{const d=(c,u)=>{r({from:c,to:u})};return e.jsx("div",{className:s,children:e.jsx(B,{position:l,onPieceDrop:d,boardOrientation:a?"black":"white",customSquareStyles:G(n),customDarkSquareStyle:{backgroundColor:"var(--dark-square)"},customLightSquareStyle:{backgroundColor:"var(--light-square)"}})})};k.defaultProps={isFinalMove:!1,result:""};k.prototype={isAnalysis:i.bool.isRequired,handleMove:i.func.isRequired,fen:i.string.isRequired,lastMove:i.object.isRequired,isFlipped:i.bool.isRequired,isFinalMove:i.bool.isFinalMove};const W=()=>{const s=N(),{isFlipped:r,timerDuration:l}=g(u=>u.game),n=()=>e.jsx("button",{onClick:()=>s(y(l)),className:"action-button",children:"Reset Board"}),a=()=>e.jsx("button",{onClick:()=>s(T()),className:"action-button",children:r?"Unflip Board":"Flip Board"}),d=()=>{console.log("downloadPGN TODO")},c=()=>e.jsx("button",{onClick:d,className:"action-button",children:"Download PGN"});return e.jsxs("nav",{className:"top-bar",children:[e.jsx(n,{}),e.jsx(a,{}),e.jsx(c,{})]})},D=()=>e.jsxs("div",{className:"top-container",children:[e.jsx(W,{}),e.jsx(w,{})]}),A=({resetGameHandler:s,timerDuration:r,gameResult:l})=>e.jsx("div",{className:"game-over-overlay",children:e.jsxs("div",{className:"game-over-message",children:[e.jsx("p",{children:l}),e.jsx("button",{className:"restart-button",onClick:()=>s(r),children:"Restart Game"})]})}),U=()=>{const s=N(),{fen:r,moveHistory:l,lastMove:n,isGameOver:a,gameResult:d,timerDuration:c,isWhiteTurn:u}=g(o=>o.game),{isFlipped:j,theme:x}=g(o=>o.settings),t=h.useCallback(({from:o,to:m})=>{if(a)return;const b=new F(r);try{const v=b.move({from:o,to:m,promotion:"q"});if(!v)return;s(M({from:o,to:m,promotionPiece:"q"})),O(E(v,b));const{isGameOver:R,gameResult:q}=I(b);R&&s(f(R,q))}catch(v){console.error(v)}},[a,s,r]),p=o=>{s(y(o))};return e.jsxs("div",{className:"main-container",children:[e.jsx(D,{}),e.jsxs("div",{className:"middle-container",children:[e.jsx("div",{className:"left-menu-bar"}),e.jsxs("div",{className:`chess-container ${x}-theme`,children:[e.jsx("div",{className:"left-panel",children:e.jsx(C,{hasGameStarted:r!==P.START_FEN,isGameOver:a,isWhiteTurn:u,isFlipped:j,timerDuration:c})}),e.jsxs("div",{className:"centre-area",children:[e.jsx(k,{className:"chess-board",fen:r,handleMove:t,lastMove:n,isFlipped:j}),a&&e.jsx(A,{resetGameHandler:p,timerDuration:c,gameResult:d})]}),e.jsx("div",{className:"right-panel",children:e.jsx($,{moveHistory:l})})]})]})]})};export{U as default};
