import{R as T,u as g,r as i,s as b,j as e,P as x,a as N,b as R,f as B,S as G,C as w,m as F,g as P,c as q,d as E,e as M}from"./index-D73wQs3Q.js";import{p as O}from"./soundUtils-v0Jzj2O8.js";const C=T.memo(({hasGameStarted:s,isGameOver:r,isWhiteTurn:n,isFlipped:a,timerDuration:l})=>{const d=g(),[o,m]=i.useState(l),[h,j]=i.useState(l),c=i.useRef(null);i.useEffect(()=>{s&&(m(l),j(l))},[s,r,l]),i.useEffect(()=>{r||(o===0?d(b(!0,"Black Won by Time")):h===0&&d(b(!0,"White Won by Time")))},[o,h,r,d]),i.useEffect(()=>{if(!s||r){c.current&&(clearInterval(c.current),c.current=null),m(l),j(l);return}if(!c.current)return c.current=setInterval(()=>{n?m(u=>u<=1?(clearInterval(c.current),c.current=null,0):u-1):j(u=>u<=1?(clearInterval(c.current),c.current=null,0):u-1)},1e3),()=>{clearInterval(c.current),c.current=null}},[s,r,l,d,n]);const p=n?"active-turn":"",t=n?"":"active-turn";return e.jsx("div",{className:"left-panel",children:e.jsx("div",{className:"clocks-container",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`clock ${p}`,children:[e.jsx("span",{role:"img","aria-label":"whitesymbol",children:"⚪"})," ",o]}),e.jsxs("div",{className:`clock ${t}`,children:[e.jsx("span",{role:"img","aria-label":"blacksymbol",children:"⚫"})," ",h]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`clock ${t}`,children:[e.jsx("span",{role:"img","aria-label":"blacksymbol",children:"⚫"})," ",h]}),e.jsxs("div",{className:`clock ${p}`,children:[e.jsx("span",{role:"img","aria-label":"whitesymbol",children:"⚪"})," ",o]})]})})})});C.propTypes={hasGameStarted:x.bool.isRequired,isWhiteTurn:x.bool.isRequired,isGameOver:x.bool.isRequired,isFlipped:x.bool.isRequired,timerDuration:x.number.isRequired};const I=({moveHistory:s})=>{const r=i.useRef(null);return i.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[s]),e.jsxs("div",{className:"move-history",children:[e.jsx("h3",{children:"Move History"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"White"}),e.jsx("th",{children:"Black"})]})}),e.jsx("tbody",{ref:r,children:s&&s.map((n,a)=>a%2===0?e.jsxs("tr",{children:[e.jsxs("td",{children:[Math.floor(a/2)+1,"."]}),e.jsx("td",{children:n}),e.jsx("td",{children:s[a+1]||""})]},a/2):null)})]})]})},S=()=>{const s=g(),{isFlipped:r,timerDuration:n}=N(m=>m.game),a=()=>e.jsx("button",{onClick:()=>s(R(n)),className:"action-button",children:"Reset Board"}),l=()=>e.jsx("button",{onClick:()=>s(B()),className:"action-button",children:r?"Unflip Board":"Flip Board"}),d=()=>{console.log("downloadPGN TODO")},o=()=>e.jsx("button",{onClick:d,className:"action-button",children:"Download PGN"});return e.jsxs("nav",{className:"top-bar",children:[e.jsx(a,{}),e.jsx(l,{}),e.jsx(o,{})]})},$=()=>e.jsxs("div",{className:"top-container",children:[e.jsx(S,{}),e.jsx(G,{})]}),W=({resetGameHandler:s,timerDuration:r,gameResult:n})=>e.jsx("div",{className:"game-over-overlay",children:e.jsxs("div",{className:"game-over-message",children:[e.jsx("p",{children:n}),e.jsx("button",{className:"restart-button",onClick:()=>s(r),children:"Restart Game"})]})}),U=()=>{const s=g(),{fen:r,moveHistory:n,lastMove:a,isGameOver:l,gameResult:d,timerDuration:o,isWhiteTurn:m}=N(t=>t.game),{isFlipped:h,theme:j}=N(t=>t.settings),c=i.useCallback(({from:t,to:u})=>{if(l)return;const f=new w(r);try{const v=f.move({from:t,to:u,promotion:"q"});if(!v)return;s(F({from:t,to:u,promotionPiece:"q"})),O(P(v,f));const{isGameOver:k,gameResult:y}=q(f);k&&s(b(k,y))}catch(v){console.error(v)}},[l,s,r]),p=t=>{s(R(t))};return e.jsxs("div",{className:"main-container",children:[e.jsx($,{}),e.jsxs("div",{className:"middle-container",children:[e.jsx("div",{className:"left-menu-bar"}),e.jsxs("div",{className:`chess-container ${j}-theme`,children:[e.jsx("div",{className:"left-panel",children:e.jsx(C,{hasGameStarted:r!==E.START_FEN,isGameOver:l,isWhiteTurn:m,isFlipped:h,timerDuration:o})}),e.jsxs("div",{className:"centre-area",children:[e.jsx(M,{className:"chess-board",fen:r,handleMove:c,lastMove:a,isFlipped:h}),l&&e.jsx(W,{resetGameHandler:p,timerDuration:o,gameResult:d})]}),e.jsx("div",{className:"right-panel",children:e.jsx(I,{moveHistory:n})})]})]})]})};export{U as default};
